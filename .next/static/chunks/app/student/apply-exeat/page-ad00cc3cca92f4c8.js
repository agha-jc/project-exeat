(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3643],{68808:function(e,t,r){Promise.resolve().then(r.bind(r,54089))},54089:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return k}});var a=r(57437),s=r(16478),l=r(99376),n=r(5485),i=r(87928),d=r(62869),o=r(66070),u=r(2265),c=r(29501),m=r(13590),x=r(67119),h=r(59121),p=r(27107),g=r(95186),y=r(44986),v=r(76818),f=r(53647),j=r(89294),_=r(98143),b=r(35153),w=r(39248);let N=[{value:"text",label:"Text Message"},{value:"phone_call",label:"Phone Call"},{value:"email",label:"Email"}],E=x.Ry({category_id:x.Z_().min(1,"Please select a category"),preferred_mode_of_contact:x.Km(["whatsapp","text","phone_call","email"],{required_error:"Please select a contact mode"}),reason:x.Z_().min(10,"Please provide a detailed reason (minimum 10 characters)"),destination:x.Z_().min(3,"Please specify your destination"),departure_date:x.hT({required_error:"Please select a departure date"}),return_date:x.hT({required_error:"Please select a return date"})}).refine(e=>{let t=new Date;t.setHours(0,0,0,0);let r=(0,h.E)(t,3),a=new Date(e.departure_date);return a.setHours(0,0,0,0),a>=r},{message:"Departure date must be at least 3 days from today",path:["departure_date"]}).refine(e=>e.return_date>=e.departure_date,{message:"Return date cannot be before departure date",path:["return_date"]}).refine(e=>!0,{message:"Exigency category allows maximum of 4 days",path:["return_date"]});function C(e){var t,r,s,l,n,i,o;let{onSuccess:x}=e,{data:C,isLoading:M,error:k}=(0,w.NL)(),[D,{isLoading:H}]=(0,w.Y2)(),S=(0,c.cI)({resolver:(0,m.F)(E),defaultValues:{category_id:"",preferred_mode_of_contact:"phone_call",reason:"",destination:""},mode:"onChange"}),P=S.watch("departure_date"),Z=S.watch("return_date"),q=S.watch("category_id"),L=(0,u.useMemo)(()=>{let e=new Date;e.setHours(0,0,0,0);let t=(0,h.E)(e,3);t.setHours(0,0,0,0);let r=new Date(e.getFullYear(),e.getMonth()+3,e.getDate());return{today:e,minDepartureDate:t,threeMonthsFromNow:r}},[]),W=(0,u.useMemo)(()=>(null==C?void 0:C.categories)?[...C.categories].sort((e,t)=>e.name.localeCompare(t.name)):[],[null==C?void 0:C.categories]),F=(0,u.useMemo)(()=>W.find(e=>String(e.id)===q),[W,q]);(0,u.useEffect)(()=>{var e;if((null==F?void 0:null===(e=F.name)||void 0===e?void 0:e.toLowerCase())==="exigency"&&P&&Z){let e=new Date(P);e.setHours(0,0,0,0);let t=(0,h.E)(e,4);t.setHours(0,0,0,0);let r=new Date(Z);r.setHours(0,0,0,0),r>t&&(S.setValue("return_date",null),S.setError("return_date",{type:"manual",message:"Exigency category allows maximum of 4 days from departure date"}))}},[F,P,Z,S]);let A=(0,u.useCallback)(e=>{let{minDepartureDate:t,threeMonthsFromNow:r}=L,a=new Date(e);return a.setHours(0,0,0,0),a<t||a>r},[L]),z=(0,u.useCallback)(e=>{let{today:t,threeMonthsFromNow:r}=L,a=new Date(e);if(a.setHours(0,0,0,0),a<t||a>r)return!0;if(P){var s;let e=new Date(P);if(e.setHours(0,0,0,0),a<e)return!0;if((null==F?void 0:null===(s=F.name)||void 0===s?void 0:s.toLowerCase())==="exigency"){let t=(0,h.E)(e,4);if(t.setHours(0,0,0,0),a>t)return!0}}return!1},[L,P,F]),Q=(0,u.useCallback)((e,t)=>{if(t.onChange(e),e&&Z&&Z<e&&S.setValue("return_date",null),e&&Z){var r;if((null==F?void 0:null===(r=F.name)||void 0===r?void 0:r.toLowerCase())==="exigency"){let t=new Date(e);t.setHours(0,0,0,0);let r=(0,h.E)(t,4);r.setHours(0,0,0,0);let a=new Date(Z);a.setHours(0,0,0,0),a>r&&S.setValue("return_date",null)}}},[Z,S,F]),R=(0,u.useCallback)(async e=>{var t,r;try{if((null==F?void 0:null===(t=F.name)||void 0===t?void 0:t.toLowerCase())==="exigency"&&e.departure_date&&e.return_date){let t=new Date(e.departure_date);t.setHours(0,0,0,0);let r=new Date(e.return_date);r.setHours(0,0,0,0);let a=(0,h.E)(t,4);if(a.setHours(0,0,0,0),r>a){S.setError("return_date",{type:"manual",message:"Exigency category allows maximum of 4 days from departure date"}),(0,b.Am)({variant:"destructive",title:"Validation Error",description:"Exigency category allows maximum of 4 days from departure date",duration:5e3});return}}let r={...e,category_id:Number(e.category_id),departure_date:(0,p.WU)(e.departure_date,"yyyy-MM-dd"),return_date:(0,p.WU)(e.return_date,"yyyy-MM-dd")},a=await D(r).unwrap();(0,b.Am)({variant:"success",title:"Success",description:a.message||"Exeat request submitted successfully.",duration:3e3}),S.reset(),null==x||x()}catch(e){if(console.log("Error object:",e),(null==e?void 0:e.status)===403&&(null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.message)){(0,b.Am)({variant:"destructive",title:"Existing Request",description:e.data.message,duration:5e3}),setTimeout(()=>null==x?void 0:x(),100);return}(0,b.Am)({variant:"destructive",title:"Error",description:"Failed to submit exeat request. Please try again.",duration:5e3})}},[D,S,x,F]);return M?(0,a.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,a.jsxs)("div",{className:"space-y-4 text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading form data..."})]})}):k?(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"p-4 bg-destructive/10 text-destructive rounded-md",children:[(0,a.jsx)("p",{children:"Failed to load exeat categories. Please try again later."}),(0,a.jsx)("p",{className:"text-sm mt-2",children:k.toString()})]})}):(null==C?void 0:C.categories)?(0,a.jsxs)("form",{onSubmit:S.handleSubmit(R),className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)(d.z,{type:"button",variant:"ghost",className:"h-8 w-8 p-0 absolute right-4 top-4",onClick:x,children:[(0,a.jsx)(y.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,a.jsxs)(j.W,{label:"Exeat Category",error:null===(t=S.formState.errors.category_id)||void 0===t?void 0:t.message,children:[(0,a.jsx)(c.Qr,{control:S.control,name:"category_id",render:e=>{let{field:t}=e;return(0,a.jsxs)(f.Ph,{value:t.value,onValueChange:t.onChange,children:[(0,a.jsx)(f.i4,{children:(0,a.jsx)(f.ki,{placeholder:"Select Category",children:t.value&&F?F.name.charAt(0).toUpperCase()+F.name.slice(1):"Select Category"})}),(0,a.jsx)(f.Bw,{children:W.map(e=>(0,a.jsx)(f.Ql,{value:String(e.id),className:"cursor-pointer",children:(0,a.jsxs)("div",{className:"flex flex-col items-start w-full py-1",children:[(0,a.jsx)("span",{className:"font-medium",children:e.name.charAt(0).toUpperCase()+e.name.slice(1)}),e.description&&(0,a.jsx)("span",{className:"text-xs text-muted-foreground mt-1 leading-relaxed max-w-[300px]",children:e.description})]})},e.id))})]})}}),(null==F?void 0:F.description)&&(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mt-2 p-3 bg-muted/50 rounded-md border",children:[(0,a.jsx)("span",{className:"font-medium",children:"About this category:"})," ",F.description]})]}),(0,a.jsx)(j.W,{label:"Preferred Contact Method (How can we contact your parent/guardian?)",error:null===(r=S.formState.errors.preferred_mode_of_contact)||void 0===r?void 0:r.message,children:(0,a.jsx)(c.Qr,{control:S.control,name:"preferred_mode_of_contact",render:e=>{let{field:t}=e;return(0,a.jsxs)(f.Ph,{value:t.value,onValueChange:t.onChange,children:[(0,a.jsx)(f.i4,{children:(0,a.jsx)(f.ki,{placeholder:"Select contact mode"})}),(0,a.jsx)(f.Bw,{children:N.map(e=>(0,a.jsx)(f.Ql,{value:e.value,children:e.label},e.value))})]})}})})]}),(0,a.jsx)(j.W,{label:"Reason for Exeat",error:null===(s=S.formState.errors.reason)||void 0===s?void 0:s.message,children:(0,a.jsx)(c.Qr,{control:S.control,name:"reason",render:e=>{let{field:t}=e;return(0,a.jsx)(v.g,{...t,placeholder:"Please provide a detailed reason for your exeat request",className:"min-h-[100px] resize-none"})}})}),(0,a.jsx)(j.W,{label:"Destination",error:null===(l=S.formState.errors.destination)||void 0===l?void 0:l.message,children:(0,a.jsx)(c.Qr,{control:S.control,name:"destination",render:e=>{let{field:t}=e;return(0,a.jsx)(g.I,{...t,placeholder:"Where are you going?"})}})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsxs)(j.W,{label:"Departure Date",error:null===(n=S.formState.errors.departure_date)||void 0===n?void 0:n.message,children:[(0,a.jsx)(c.Qr,{control:S.control,name:"departure_date",render:e=>{let{field:t}=e;return(0,a.jsx)(_.M,{value:t.value,onChange:e=>Q(e,t),disabled:A})}}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Note: Departure date must be at least 3 days from today.",(null==L?void 0:L.minDepartureDate)&&(0,a.jsxs)(a.Fragment,{children:[" ","Earliest allowed date: ",(0,p.WU)(L.minDepartureDate,"MMM d, yyyy")]})]})]}),(0,a.jsxs)(j.W,{label:"Return Date",error:null===(i=S.formState.errors.return_date)||void 0===i?void 0:i.message,children:[(0,a.jsx)(c.Qr,{control:S.control,name:"return_date",render:e=>{let{field:t}=e;return(0,a.jsx)(_.M,{value:t.value,onChange:t.onChange,disabled:z})}}),(null==F?void 0:null===(o=F.name)||void 0===o?void 0:o.toLowerCase())==="exigency"&&P&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Note: Exigency category allows maximum of 4 days from departure date.",P&&(0,a.jsxs)(a.Fragment,{children:[" ","Latest allowed return date: ",(0,p.WU)((0,h.E)(P,4),"MMM d, yyyy")]})]})]})]}),(0,a.jsx)(d.z,{type:"submit",className:"w-full",disabled:H,children:H?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-b-2 border-white"}),"Submitting..."]}):"Submit Exeat Request"})]}):(0,a.jsx)("div",{className:"p-4 bg-destructive/10 text-destructive rounded-md",children:(0,a.jsx)("p",{children:"Unable to load required data. Please refresh the page and try again."})})}let M={initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5}};function k(){let e=(0,l.useRouter)();return(0,a.jsxs)("div",{className:"py-8 px-4",children:[(0,a.jsxs)(s.E.div,{initial:"initial",animate:"animate",variants:M,className:"flex items-center gap-4 mb-6",children:[(0,a.jsx)(d.z,{variant:"ghost",size:"icon",onClick:()=>e.back(),className:"h-8 w-8",children:(0,a.jsx)(n.Z,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold tracking-tight",children:"Apply for Exeat"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Submit a new exeat request"})]})]}),(0,a.jsx)("div",{className:"grid gap-6",children:(0,a.jsx)(s.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},children:(0,a.jsxs)(o.Zb,{children:[(0,a.jsxs)(o.Ol,{children:[(0,a.jsxs)(o.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(i.Z,{className:"h-5 w-5 text-primary"}),"Exeat Request Form"]}),(0,a.jsx)(o.SZ,{children:"Fill in all required fields"})]}),(0,a.jsx)(o.aY,{children:(0,a.jsx)(C,{onSuccess:()=>{e.push("/student/exeats")}})})]})})})]})}},5485:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(96471).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},87928:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(96471).Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},44986:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(96471).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},function(e){e.O(0,[2915,3557,9946,5844,9049,2061,9923,7873,6478,6245,4658,4438,2971,2117,1744],function(){return e(e.s=68808)}),_N_E=e.O()}]);