(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8286],{81661:function(e,t,r){Promise.resolve().then(r.bind(r,70338))},70338:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return R}});var s=r(57437),a=r(2265),n=r(29501),u=r(67119),o=r(13590),i=r(27107),d=r(95186),l=r(62869),c=r(76818),m=r(89294),x=r(98143),f=r(53647),g=r(35153),p=r(28233),q=r(39248);let v=u.Ry({student_id:u.Z_().min(1,"Enter a valid student ID").transform(e=>Number(e)).pipe(u.Rx().int().positive("Student ID must be a positive integer")),category_id:u.Z_().min(1,"Please select a category"),reason:u.Z_().min(10,"Please provide a detailed reason (minimum 10 characters)"),destination:u.Z_().min(3,"Please specify the destination"),departure_date:u.hT({required_error:"Please select a departure date"}),return_date:u.hT({required_error:"Please select a return date"})}).refine(e=>e.return_date>=e.departure_date,{message:"Return date cannot be before departure date",path:["return_date"]});function y(e){var t,r,u,y,h,b;let{onSuccess:R}=e,{data:j,isLoading:_,error:E}=(0,q.NL)(),[S,{isLoading:T}]=(0,p.CD)(),C=(0,n.cI)({resolver:(0,o.F)(v),defaultValues:{student_id:"",category_id:"",reason:"",destination:""},mode:"onChange"}),D=C.watch("departure_date"),N=(0,a.useMemo)(()=>{let e=new Date;e.setHours(0,0,0,0);let t=new Date(e.getFullYear(),e.getMonth()+3,e.getDate());return{today:e,threeMonthsFromNow:t}},[]),P=(0,a.useMemo)(()=>(null==j?void 0:j.categories)?[...j.categories].sort((e,t)=>e.name.localeCompare(t.name)):[],[null==j?void 0:j.categories]),w=(0,a.useCallback)(e=>{let{today:t,threeMonthsFromNow:r}=N,s=new Date(e);return s.setHours(0,0,0,0),s<t||s>r},[N]),O=(0,a.useCallback)(e=>{let{today:t,threeMonthsFromNow:r}=N,s=new Date(e);if(s.setHours(0,0,0,0),s<t||s>r)return!0;if(D){let e=new Date(D);if(e.setHours(0,0,0,0),s<e)return!0}return!1},[N,D]),k=(0,a.useCallback)(async e=>{try{let t={student_id:Number(e.student_id),category_id:Number(e.category_id),reason:e.reason,destination:e.destination,departure_date:(0,i.WU)(e.departure_date,"yyyy-MM-dd"),return_date:(0,i.WU)(e.return_date,"yyyy-MM-dd")},r=await S(t).unwrap();(0,g.Am)({variant:"success",title:"Success",description:r.message||"Exeat request submitted for student.",duration:3e3}),C.reset(),null==R||R()}catch(e){var t;(0,g.Am)({variant:"destructive",title:"Error",description:(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to submit exeat request.",duration:5e3})}},[S,C,R]);return _?(0,s.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,s.jsxs)("div",{className:"space-y-4 text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Loading form data..."})]})}):E?(0,s.jsx)("div",{className:"p-4 bg-destructive/10 text-destructive rounded-md",children:(0,s.jsx)("p",{children:"Failed to load exeat categories. Please try again later."})}):(0,s.jsxs)("form",{onSubmit:C.handleSubmit(k),className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsx)(m.W,{label:"Student ID",error:null===(t=C.formState.errors.student_id)||void 0===t?void 0:t.message,children:(0,s.jsx)(n.Qr,{control:C.control,name:"student_id",render:e=>{let{field:t}=e;return(0,s.jsx)(d.I,{...t,inputMode:"numeric",placeholder:"Enter student ID (e.g. 2031)"})}})}),(0,s.jsx)(m.W,{label:"Exeat Category",error:null===(r=C.formState.errors.category_id)||void 0===r?void 0:r.message,children:(0,s.jsx)(n.Qr,{control:C.control,name:"category_id",render:e=>{let{field:t}=e;return(0,s.jsxs)(f.Ph,{value:t.value,onValueChange:t.onChange,children:[(0,s.jsx)(f.i4,{children:(0,s.jsx)(f.ki,{placeholder:"Select Category"})}),(0,s.jsx)(f.Bw,{children:P.map(e=>(0,s.jsx)(f.Ql,{value:String(e.id),children:e.name.charAt(0).toUpperCase()+e.name.slice(1)},e.id))})]})}})})]}),(0,s.jsx)(m.W,{label:"Reason",error:null===(u=C.formState.errors.reason)||void 0===u?void 0:u.message,children:(0,s.jsx)(n.Qr,{control:C.control,name:"reason",render:e=>{let{field:t}=e;return(0,s.jsx)(c.g,{...t,placeholder:"Reason for exeat",className:"min-h-[100px] resize-none"})}})}),(0,s.jsx)(m.W,{label:"Destination",error:null===(y=C.formState.errors.destination)||void 0===y?void 0:y.message,children:(0,s.jsx)(n.Qr,{control:C.control,name:"destination",render:e=>{let{field:t}=e;return(0,s.jsx)(d.I,{...t,placeholder:"Enter destination"})}})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsx)(m.W,{label:"Departure Date",error:null===(h=C.formState.errors.departure_date)||void 0===h?void 0:h.message,children:(0,s.jsx)(n.Qr,{control:C.control,name:"departure_date",render:e=>{let{field:t}=e;return(0,s.jsx)(x.M,{value:t.value,onChange:t.onChange,disabled:w})}})}),(0,s.jsx)(m.W,{label:"Return Date",error:null===(b=C.formState.errors.return_date)||void 0===b?void 0:b.message,children:(0,s.jsx)(n.Qr,{control:C.control,name:"return_date",render:e=>{let{field:t}=e;return(0,s.jsx)(x.M,{value:t.value,onChange:t.onChange,disabled:O})}})})]}),(0,s.jsx)(l.z,{type:"submit",className:"w-full",disabled:T,children:T?"Submitting...":"Submit Exeat For Student"})]})}var h=r(66070),b=r(99376);function R(){let e=(0,b.useRouter)();return(0,s.jsx)("div",{className:"p-6 w-full",children:(0,s.jsxs)(h.Zb,{children:[(0,s.jsxs)(h.Ol,{children:[(0,s.jsx)(h.ll,{children:"Apply Exeat For Student"}),(0,s.jsx)(h.SZ,{children:"Submit an exeat request on behalf of a student."})]}),(0,s.jsx)(h.aY,{children:(0,s.jsx)(y,{onSuccess:()=>e.push("/staff/admin/exeats")})})]})})}},28233:function(e,t,r){"use strict";r.d(t,{CD:function(){return h},Og:function(){return l},RX:function(){return g},Rk:function(){return o},Sr:function(){return a},Tq:function(){return c},Vm:function(){return i},b:function(){return s},cu:function(){return n},js:function(){return p},mM:function(){return y},oZ:function(){return f},s$:function(){return m},ui:function(){return v},vN:function(){return u},w9:function(){return x},xA:function(){return b},yH:function(){return d}});let{useGetStaffProfileQuery:s,useGetAllExeatRequestsQuery:a,useGetExeatRequestsByStatusQuery:n,useGetExeatRequestByIdQuery:u,useGetExeatRequestsByStudentIdQuery:o,useApproveExeatRequestMutation:i,useRejectExeatRequestMutation:d,useSignStudentOutMutation:l,useSignStudentInMutation:c,useGetExeatStatisticsQuery:m,useGetCompletedExeatRequestsQuery:x,useGetCompletedExeatRequestDetailsQuery:f,useGetRejectedExeatRequestsQuery:g,useGetRejectedExeatRequestDetailsQuery:p,useGetStaffDashboardStatsQuery:q,useSendCommentMutation:v,useEditExeatRequestMutation:y,useDeanApplyExeatRequestMutation:h,useDeanBulkApproveExeatsMutation:b}=r(46144).h.injectEndpoints({endpoints:e=>({getStaffProfile:e.query({query:()=>"/me",transformResponse:e=>e.user,providesTags:["Profile"]}),getAllExeatRequests:e.query({query:()=>"/staff/exeat-requests",transformResponse:e=>e.exeat_requests,providesTags:["ExeatRequests"]}),getExeatRequestsByStudentId:e.query({query:e=>({url:"/staff/exeat-requests",params:{student_id:e}}),transformResponse:e=>{var t;return Array.isArray(e)?e:"exeat_requests"in e?e.exeat_requests:(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.exeat_requests)?e.data.exeat_requests:[]},providesTags:["ExeatRequests"]}),getExeatRequestsByStatus:e.query({query:e=>"/staff/exeat-requests?status=".concat(e),transformResponse:e=>e.exeat_requests,providesTags:["ExeatRequests"]}),getExeatRequestById:e.query({query:e=>"/staff/exeat-requests/".concat(e),transformResponse:e=>{if((null==e?void 0:e.message)&&e.message.includes("permission"))throw Error(e.message);if(null==e?void 0:e.exeat_request)return e.exeat_request;throw Error("Invalid response format from server")},providesTags:(e,t,r)=>[{type:"ExeatRequests",id:r}]}),approveExeatRequest:e.mutation({query:e=>{let{exeat_request_id:t,comment:r}=e;return{url:"/staff/exeat-requests/".concat(t,"/approve"),method:"POST",body:{comment:r}}},invalidatesTags:["ExeatRequests"]}),rejectExeatRequest:e.mutation({query:e=>{let{exeat_request_id:t,comment:r}=e;return{url:"/staff/exeat-requests/".concat(t,"/reject"),method:"POST",body:{comment:r}}},invalidatesTags:["ExeatRequests"]}),signStudentOut:e.mutation({query:e=>{let{exeat_request_id:t,comment:r}=e;return{url:"/staff/exeat-requests/".concat(t,"/sign-out"),method:"POST",body:{comment:r}}},invalidatesTags:["ExeatRequests"]}),signStudentIn:e.mutation({query:e=>{let{exeat_request_id:t,comment:r}=e;return{url:"/staff/exeat-requests/".concat(t,"/sign-in"),method:"POST",body:{comment:r}}},invalidatesTags:["ExeatRequests"]}),getExeatStatistics:e.query({query:()=>"/staff/exeat-statistics",transformResponse:e=>e.data,providesTags:["Staff"]}),getCompletedExeatRequests:e.query({query:function(){let{page:e=1,per_page:t=50}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{url:"/exeats/by-status/completed",params:{page:e,per_page:t}}},transformResponse:e=>e,providesTags:["ExeatRequests"]}),getCompletedExeatRequestDetails:e.query({query:e=>"/exeats/by-status/completed/".concat(e),transformResponse:e=>e,providesTags:["ExeatRequests"]}),getStaffDashboardStats:e.query({query:()=>"/staff/dashboard",transformResponse:e=>e,providesTags:["DashboardStats"]}),getRejectedExeatRequests:e.query({query:function(){let{page:e=1,per_page:t=50}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{url:"/exeats/by-status/rejected",params:{page:e,per_page:t}}},transformResponse:e=>e,providesTags:["ExeatRequests"]}),getRejectedExeatRequestDetails:e.query({query:e=>"/exeats/by-status/rejected/".concat(e),transformResponse:e=>e,providesTags:["ExeatRequests"]}),sendComment:e.mutation({query:e=>{let{exeat_request_id:t,comment:r}=e;return{url:"/staff/exeat-requests/".concat(t,"/send-comment"),method:"POST",body:{comment:r,priority:"high"}}},invalidatesTags:["ExeatRequests"]}),editExeatRequest:e.mutation({query:e=>{let{exeat_request_id:t,payload:r}=e;return{url:"/staff/exeat-requests/".concat(t),method:"PUT",body:r}},invalidatesTags:["ExeatRequests"]}),deanApplyExeatRequest:e.mutation({query:e=>({url:"/dean/exeat-requests",method:"POST",body:e}),invalidatesTags:["ExeatRequests"]}),deanBulkApproveExeats:e.mutation({query:()=>({url:"/dean/exeat-requests/bulkAprroval",method:"POST"}),invalidatesTags:["ExeatRequests"]})})})}},function(e){e.O(0,[2915,3557,9946,5844,9049,2061,9923,7873,6245,4658,4438,2971,2117,1744],function(){return e(e.s=81661)}),_N_E=e.O()}]);