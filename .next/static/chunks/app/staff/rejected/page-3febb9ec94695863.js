(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6692],{50167:function(e,s,t){Promise.resolve().then(t.bind(t,34632))},34632:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return k}});var a=t(57437),n=t(28233),l=t(66070),r=t(35974),i=t(16831),d=t(62869),c=t(95186),o=t(93022),u=t(73578),m=t(10346),x=t(27107),h=t(74376),j=t(23818),p=t(87928),f=t(13147),g=t(98012),v=t(56141),N=t(82521),w=t(76848),y=t(2265),b=t(99376),_=t(34324);function k(){var e,s,t;let[k,C]=(0,y.useState)(1),[R]=(0,y.useState)(50),[S,Z]=(0,y.useState)(""),q=(0,b.useRouter)(),{data:L,isLoading:A}=(0,n.RX)({page:k,per_page:R}),O=e=>{q.push("/staff/exeat-requests/rejected/".concat(e))},P=(null==L?void 0:null===(e=L.data)||void 0===e?void 0:e.data)||[],z=null==L?void 0:L.pagination,M=P.filter(e=>{let s=S.toLowerCase();return e.student.name.toLowerCase().includes(s)||e.student.email.toLowerCase().includes(s)||e.reason.toLowerCase().includes(s)||e.destination.toLowerCase().includes(s)}),E=e=>e.split(" ").map(e=>e.charAt(0)).join("").toUpperCase(),I=e=>{try{return(0,x.WU)(new Date(e),"PP")}catch(s){return e}};return A?(0,a.jsx)(_.i,{requiredRole:"staff",children:(0,a.jsx)("div",{className:"min-h-screen",children:(0,a.jsxs)("div",{className:"w-full px-4 py-8 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)(o.O,{className:"h-8 w-64 mb-2"}),(0,a.jsx)(o.O,{className:"h-4 w-96"})]}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(o.O,{className:"h-6 w-48"})}),(0,a.jsx)(l.aY,{children:(0,a.jsx)("div",{className:"space-y-4",children:Array.from({length:5}).map((e,s)=>(0,a.jsx)(o.O,{className:"h-16 w-full"},s))})})]})]})})}):(0,a.jsx)(_.i,{requiredRole:"staff",children:(0,a.jsx)("div",{className:"min-h-screen",children:(0,a.jsxs)("div",{className:"w-full p-4",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"Rejected Exeat Requests"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:"View all rejected exeat requests and their details"})]})}),(null==L?void 0:L.status_summary)&&(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Rejected"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:L.status_summary.total_count})]}),(0,a.jsx)(h.Z,{className:"h-8 w-8 text-red-600"})]})})}),(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Medical Requests"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:L.status_summary.medical_count})]}),(0,a.jsx)(h.Z,{className:"h-8 w-8 text-red-600"})]})})}),(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Regular Requests"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:L.status_summary.regular_count})]}),(0,a.jsx)(h.Z,{className:"h-8 w-8 text-orange-600"})]})})})]})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(j.Z,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(c.I,{placeholder:"Search by student name, email, reason, or destination...",value:S,onChange:e=>{Z(e.target.value),1!==k&&C(1)},className:"pl-10"})]})}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsx)(l.ll,{children:"Rejected Exeat Requests"}),(0,a.jsx)(l.SZ,{children:z?(0,a.jsxs)(a.Fragment,{children:["Showing ",null!==(s=z.from)&&void 0!==s?s:0," to ",null!==(t=z.to)&&void 0!==t?t:0," of ",z.total," rejected requests",S&&" (".concat(M.length," match").concat(1!==M.length?"es":""," on this page)")]}):"".concat(M.length," of ").concat(P.length," requests")})]}),(0,a.jsxs)(l.aY,{children:[0===M.length?(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(p.Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:"No rejected requests found"}),(0,a.jsx)("p",{className:"text-sm",children:"Rejected exeat requests will appear here"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"lg:hidden space-y-4",children:M.map(e=>(0,a.jsxs)(l.Zb,{className:"p-4 hover:shadow-md transition-shadow duration-200 cursor-pointer",onClick:()=>O(e.id),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,a.jsx)(i.qE,{className:"h-10 w-10 flex-shrink-0",children:(0,a.jsx)(i.Q5,{className:"text-xs",children:E(e.student.name)})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"font-semibold text-base truncate",children:e.student.name}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:e.student.email})]})]}),(0,a.jsx)(r.C,{variant:"destructive",className:"bg-red-100 text-red-800",children:e.status})]}),(0,a.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("span",{children:[I(e.departure_date)," - ",I(e.return_date)]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(g.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{children:e.destination})]}),(0,a.jsx)("div",{className:"flex items-center gap-2 text-sm",children:(0,a.jsx)(r.C,{variant:e.is_medical?"destructive":"default",className:"text-xs",children:e.category})})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:e.reason}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Rejected on ",I(e.updated_at)]}),(0,a.jsxs)(d.z,{variant:"outline",size:"sm",onClick:s=>{s.stopPropagation(),O(e.id)},className:"text-xs hover:bg-red-50 hover:text-red-700 hover:border-red-300 transition-colors",children:[(0,a.jsx)(v.Z,{className:"h-3 w-3 mr-1"}),"View Details"]})]})]},e.id))}),(0,a.jsx)("div",{className:"hidden lg:block",children:(0,a.jsxs)(u.iA,{children:[(0,a.jsx)(u.xD,{children:(0,a.jsxs)(u.SC,{children:[(0,a.jsx)(u.ss,{children:"Student"}),(0,a.jsx)(u.ss,{children:"Category"}),(0,a.jsx)(u.ss,{children:"Dates"}),(0,a.jsx)(u.ss,{children:"Destination"}),(0,a.jsx)(u.ss,{children:"Rejected"}),(0,a.jsx)(u.ss,{className:"w-[120px]",children:"Actions"})]})}),(0,a.jsx)(u.RM,{children:M.map(e=>(0,a.jsxs)(u.SC,{className:"hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>O(e.id),children:[(0,a.jsx)(u.pj,{children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(i.qE,{className:"h-8 w-8",children:(0,a.jsx)(i.Q5,{className:"text-xs",children:E(e.student.name)})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.student.name}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.student.email})]})]})}),(0,a.jsx)(u.pj,{children:(0,a.jsx)("div",{className:"flex gap-1",children:(0,a.jsx)(r.C,{variant:e.is_medical?"destructive":"default",children:e.category})})}),(0,a.jsx)(u.pj,{children:(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("p",{children:I(e.departure_date)}),(0,a.jsxs)("p",{className:"text-muted-foreground",children:["to ",I(e.return_date)]})]})}),(0,a.jsx)(u.pj,{children:e.destination}),(0,a.jsx)(u.pj,{className:"text-sm text-muted-foreground",children:I(e.updated_at)}),(0,a.jsx)(u.pj,{children:(0,a.jsxs)(d.z,{variant:"outline",size:"sm",onClick:s=>{s.stopPropagation(),O(e.id)},className:"text-xs hover:bg-red-50 hover:text-red-700 hover:border-red-300 transition-colors",children:[(0,a.jsx)(v.Z,{className:"h-3 w-3 mr-1"}),"View"]})})]},e.id))})]})})]}),z&&z.last_page>1&&(0,a.jsxs)("div",{className:"mt-6 flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Page ",z.current_page," of ",z.last_page]}),(0,a.jsx)(m.tl,{children:(0,a.jsxs)(m.ng,{children:[(0,a.jsx)(m.nt,{children:(0,a.jsxs)(d.z,{variant:"ghost",size:"sm",onClick:()=>C(Math.max(1,k-1)),disabled:1===k,className:"gap-1",children:[(0,a.jsx)(N.Z,{className:"h-4 w-4"}),"Previous"]})}),(()=>{if(!z)return[];let e=[],s=z.last_page,t=z.current_page;if(s<=7)for(let t=1;t<=s;t++)e.push(t);else{e.push(1),t>3&&e.push("ellipsis");let a=Math.max(2,t-1),n=Math.min(s-1,t+1);for(let s=a;s<=n;s++)e.push(s);t<s-2&&e.push("ellipsis"),e.push(s)}return e})().map((e,s)=>(0,a.jsx)(m.nt,{children:"ellipsis"===e?(0,a.jsx)(m.Dj,{}):(0,a.jsx)(d.z,{variant:e===z.current_page?"outline":"ghost",size:"sm",onClick:()=>C(e),className:"min-w-[40px]",children:e})},s)),(0,a.jsx)(m.nt,{children:(0,a.jsxs)(d.z,{variant:"ghost",size:"sm",onClick:()=>C(Math.min(z.last_page,k+1)),disabled:k===z.last_page,className:"gap-1",children:["Next",(0,a.jsx)(w.Z,{className:"h-4 w-4"})]})})]})})]})]})]})]})})})}},34324:function(e,s,t){"use strict";t.d(s,{i:function(){return d}});var a=t(57437),n=t(2265),l=t(99376),r=t(68575),i=t(61796);function d(e){let{children:s,requiredRole:t}=e,d=(0,l.useRouter)(),c=(0,r.v9)(i.HF),o=(0,r.v9)(i.vN);return((0,n.useEffect)(()=>{if(!o){d.push("/login");return}if(t&&(null==c?void 0:c.role)){let e=c.role.toLowerCase(),s=t.toLowerCase(),a="student"===e?"student":"staff";a!==("student"===s?"student":"staff")&&d.push("student"===a?"/student/dashboard":"/staff/dashboard")}},[o,c,t,d]),!o||t&&(null==c?void 0:c.role)&&("student"===c.role.toLowerCase()?"student":"staff")!=("student"===t.toLowerCase()?"student":"staff"))?null:(0,a.jsx)(a.Fragment,{children:s})}},16262:function(e,s,t){"use strict";t.d(s,{Mx:function(){return r},YA:function(){return n},_y:function(){return l},iJ:function(){return a}});let a=t(46144).h.injectEndpoints({endpoints:e=>({login:e.mutation({query:e=>({url:"/login",method:"POST",body:e})}),logout:e.mutation({query:()=>({url:"/logout",method:"POST"})}),getProfile:e.query({query:()=>"/me",providesTags:["Profile"]})})}),{useLoginMutation:n,useLogoutMutation:l,useGetProfileQuery:r}=a},61796:function(e,s,t){"use strict";t.d(s,{Dj:function(){return m},HF:function(){return x},kS:function(){return u},vN:function(){return h},xU:function(){return j}});var a=t(39129),n=t(16262);let l=e=>{try{return localStorage.getItem(e)}catch(e){return null}},r=()=>{let e=l("user");try{let s=e?JSON.parse(e):null;if(s&&s.exeat_roles&&!s.roles){let e=s.exeat_roles.map(e=>{var s;return(null==e?void 0:null===(s=e.role)||void 0===s?void 0:s.name)?e.role.name:(null==e?void 0:e.name)?e.name:(null==e?void 0:e.display_name)?e.display_name:"string"==typeof e?e:"Unknown Role"});s.roles=e}return s}catch(e){return null}},i={user:r(),token:l("token"),isAuthenticated:!!(l("token")&&r()),isLoading:!1},d=(0,a.oM)({name:"auth",initialState:i,reducers:{startLoading:e=>{e.isLoading=!0},stopLoading:e=>{e.isLoading=!1},logout:e=>{e.user=null,e.token=null,e.isAuthenticated=!1,localStorage.removeItem("token"),localStorage.removeItem("user")},setCredentials:(e,s)=>{let{user:t,role:a,token:n}=s.payload,l=(null==t?void 0:t.exeat_roles)||s.payload.roles,r=Array.isArray(l)?l.map(e=>{var s;return(null==e?void 0:null===(s=e.role)||void 0===s?void 0:s.name)?e.role.name:(null==e?void 0:e.name)?e.name:(null==e?void 0:e.display_name)?e.display_name:"string"==typeof e?e:"Unknown Role"}):[],i={...t,role:a,roles:r};e.user=i,e.token=n,e.isAuthenticated=!0,localStorage.setItem("token",n),localStorage.setItem("user",JSON.stringify(i))}},extraReducers:e=>{e.addMatcher(n.iJ.endpoints.login.matchPending,e=>{e.isLoading=!0}).addMatcher(n.iJ.endpoints.login.matchFulfilled,(e,s)=>{var t;let{payload:a}=s,n=(null===(t=a.user)||void 0===t?void 0:t.exeat_roles)||a.roles,l=Array.isArray(n)?n.map(e=>{var s;return(null==e?void 0:null===(s=e.role)||void 0===s?void 0:s.name)?e.role.name:(null==e?void 0:e.name)?e.name:(null==e?void 0:e.display_name)?e.display_name:"string"==typeof e?e:"Unknown Role"}):[],r={...a.user,role:a.role,roles:l};e.user=r,e.token=a.token,e.isAuthenticated=!0,e.isLoading=!1,localStorage.setItem("token",a.token),localStorage.setItem("user",JSON.stringify(r))}).addMatcher(n.iJ.endpoints.login.matchRejected,e=>{e.isLoading=!1})}}),{startLoading:c,stopLoading:o,logout:u,setCredentials:m}=d.actions;s.ZP=d.reducer;let x=e=>e.auth.user,h=e=>e.auth.isAuthenticated,j=e=>e.auth.isLoading},74376:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(96471).Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])}},function(e){e.O(0,[2915,3557,9946,3799,6588,2971,2117,1744],function(){return e(e.s=50167)}),_N_E=e.O()}]);