"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1711],{11711:function(e,s,t){t.d(s,{h:function(){return b}});var a=t(57437),n=t(2265),r=t(62869),l=t(16831),i=t(21378),c=t(26110),d=t(76818),o=t(66070),m=t(73578),u=t(46747),p=t(88880),x=t(5255),h=t(74376),j=t(87928),f=t(19965),g=t(66314),N=t(53717),y=t(44259),w=t(35153);let b=e=>{let{requests:s,onApprove:t,onReject:b,onSignOut:v,onSignIn:_,onSendComment:q,onViewDetails:C}=e,{toast:k}=(0,w.pm)(),z=(e,s)=>"".concat((e||"").charAt(0)).concat((s||"").charAt(0)).toUpperCase(),[R,Z]=(0,n.useState)({isOpen:!1,type:null,requestId:null,comment:"",request:null,isLoading:!1}),E=(e,t)=>{let a=s.find(e=>e.id===t);Z({isOpen:!0,type:e,requestId:t,comment:"",request:a||null,isLoading:!1})},S=async()=>{if(R.requestId&&R.type){Z(e=>({...e,isLoading:!0}));try{if("approve"===R.type)await t(R.requestId,R.comment||void 0),k({title:"Success",description:"Exeat request approved successfully."});else if("reject"===R.type)await b(R.requestId,R.comment||void 0),k({title:"Success",description:"Exeat request rejected successfully."});else if("see_me"===R.type&&q)try{await q(R.requestId,R.comment),k({title:"Success",description:"Comment sent to student successfully."})}catch(s){console.error("Error sending comment:",s);let e="Failed to send comment. Please try again.";throw s.message&&(e=s.message),k({title:"Error",description:e,variant:"destructive"}),s}Z({isOpen:!1,type:null,requestId:null,comment:"",request:null,isLoading:!1})}catch(e){console.error("Error processing action:",e),k({title:"Error",description:"Failed to ".concat("see_me"===R.type?"send comment":R.type," request. Please try again."),variant:"destructive"}),Z(e=>({...e,isLoading:!1}))}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"lg:hidden space-y-3",children:s.map(e=>{let s=e.student.passport?"data:image/jpeg;base64,".concat(e.student.passport):"",t=(e.preferred_mode_of_contact||"").toLowerCase(),n="email"===t?e.parent_email:e.parent_phone_no||e.parent_phone_no_two;return(0,a.jsxs)(o.Zb,{className:"p-4 hover:shadow-md transition-shadow duration-200",children:[(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,a.jsxs)(l.qE,{className:"h-10 w-10 flex-shrink-0",children:[(0,a.jsx)(l.F$,{src:s,alt:"".concat(e.student.fname," ").concat(e.student.lname)}),(0,a.jsx)(l.Q5,{className:"text-xs",children:z(e.student.fname,e.student.lname)})]}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsxs)("h3",{className:"font-semibold text-base truncate",children:[e.student.fname," ",e.student.lname]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground font-mono truncate",children:e.matric_no})]})]}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(i.t,{status:e.status,size:"sm"})})]}),"security_signin"===e.status&&e.departure_date&&e.return_date&&(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsx)(N.Y,{departureDate:e.departure_date,returnDate:e.return_date,variant:"staff",className:"w-full"})}),(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsxs)("div",{className:"inline-flex items-center gap-2 px-2.5 py-1 rounded-full bg-slate-100 text-slate-700",children:["email"===t?(0,a.jsx)(u.Z,{className:"h-3.5 w-3.5"}):(0,a.jsx)(p.Z,{className:"h-3.5 w-3.5"}),(0,a.jsx)("span",{className:"text-xs font-medium",children:"whatsapp"===t?"WhatsApp":"text"===t?"Text":"phone_call"===t?"Phone":"email"===t?"Email":"Contact"}),n&&(0,a.jsx)("span",{className:"text-xs font-mono truncate max-w-[140px]",children:n})]})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsxs)(r.z,{size:"sm",className:"flex-1 min-w-[100px] bg-green-600 hover:bg-green-700 text-white disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>E("approve",e.id),disabled:["rejected","completed"].includes(e.status),children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 mr-1 sm:mr-2"}),(0,a.jsx)("span",{className:"truncate",children:(0,y.Q4)(e.status)})]}),!["hostel_signout","hostel_signin","security_signout","security_signin","completed","rejected"].includes(e.status)&&(0,a.jsxs)(r.z,{variant:"destructive",size:"sm",className:"flex-1 min-w-[100px]",onClick:()=>E("reject",e.id),children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 mr-1 sm:mr-2"}),(0,a.jsx)("span",{className:"truncate",children:"Reject"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsxs)(r.z,{variant:"outline",size:"sm",className:"flex-1 min-w-[100px]",onClick:()=>C(e),children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-1 sm:mr-2"}),(0,a.jsx)("span",{className:"truncate",children:"Details"})]}),!!q&&(0,a.jsxs)(r.z,{variant:"outline",size:"sm",className:"flex-1 min-w-[100px] disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>E("see_me",e.id),disabled:["hostel_signout","hostel_signin","security_signout","security_signin","completed"].includes(e.status),children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 mr-1 sm:mr-2"}),(0,a.jsx)("span",{className:"truncate",children:"See Me"})]})]})]})]},e.id)})}),(0,a.jsx)("div",{className:"hidden lg:block rounded-lg border bg-background",children:(0,a.jsxs)(m.iA,{className:"text-[15px] md:text-base",children:[(0,a.jsx)(m.xD,{className:"sticky top-0 z-10 bg-background",children:(0,a.jsxs)(m.SC,{className:"bg-muted/50",children:[(0,a.jsx)(m.ss,{className:"whitespace-nowrap text-sm md:text-base",children:"Student"}),(0,a.jsx)(m.ss,{className:"whitespace-nowrap text-sm md:text-base",children:"Status"}),(0,a.jsx)(m.ss,{className:"text-right whitespace-nowrap text-sm md:text-base",children:"Actions"})]})}),(0,a.jsx)(m.RM,{children:s.map(e=>{let s=e.student.passport?"data:image/jpeg;base64,".concat(e.student.passport):"",t=(e.preferred_mode_of_contact||"").toLowerCase(),n="email"===t?e.parent_email:e.parent_phone_no||e.parent_phone_no_two;return(0,a.jsxs)(m.SC,{className:"align-middle",children:[(0,a.jsx)(m.pj,{className:"font-medium",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)(l.qE,{className:"size-10",children:[(0,a.jsx)(l.F$,{src:s,alt:"".concat(e.student.fname," ").concat(e.student.lname)}),(0,a.jsx)(l.Q5,{className:"text-xs",children:z(e.student.fname,e.student.lname)})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("span",{className:"font-medium",children:[e.student.fname," ",e.student.lname]}),(0,a.jsx)("span",{className:"text-muted-foreground font-mono text-xs",children:e.matric_no}),(0,a.jsx)("div",{className:"mt-1 inline-flex items-center gap-2 max-w-full",children:(0,a.jsxs)("div",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-slate-100 text-slate-700",children:["email"===t?(0,a.jsx)(u.Z,{className:"h-3.5 w-3.5"}):(0,a.jsx)(p.Z,{className:"h-3.5 w-3.5"}),(0,a.jsx)("span",{className:"text-[11px] font-medium",children:"whatsapp"===t?"WhatsApp":"text"===t?"Text":"phone_call"===t?"Phone":"email"===t?"Email":"Contact"}),n&&(0,a.jsx)("span",{className:"text-[11px] font-mono truncate max-w-[180px]",children:n})]})}),"security_signout"===e.status&&e.departure_date&&e.return_date&&(0,a.jsx)("div",{className:"mt-2 max-w-full",children:(0,a.jsx)(N.Y,{departureDate:e.departure_date,returnDate:e.return_date,variant:"staff",className:"w-full max-w-md"})})]})]})}),(0,a.jsx)(m.pj,{children:(0,a.jsx)(i.t,{status:e.status,size:"sm"})}),(0,a.jsx)(m.pj,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-2",children:[(0,a.jsxs)(r.z,{size:"sm",className:"h-8 px-3 text-[13px] md:text-sm bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>E("approve",e.id),disabled:["rejected","completed"].includes(e.status),children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:(0,y.Q4)(e.status)})]}),!["hostel_signout","hostel_signin","security_signout","security_signin","completed","rejected"].includes(e.status)&&(0,a.jsxs)(r.z,{variant:"destructive",size:"sm",className:"h-8 px-3 text-[13px] md:text-sm",onClick:()=>E("reject",e.id),children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Reject"})]}),!!q&&(0,a.jsxs)(r.z,{variant:"outline",size:"sm",className:"h-8 px-3 text-[13px] md:text-sm disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>E("see_me",e.id),disabled:["hostel_signout","hostel_signin","security_signout","security_signin","completed"].includes(e.status),children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"See Me"})]}),(0,a.jsxs)(r.z,{variant:"outline",size:"sm",className:"h-8 px-3 text-[13px] md:text-sm",onClick:()=>C(e),children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Details"})]})]})})]},e.id)})})]})}),(0,a.jsx)(c.Vq,{open:R.isOpen,onOpenChange:e=>Z(s=>({...s,isOpen:e})),children:(0,a.jsxs)(c.cZ,{children:[(0,a.jsxs)(c.fK,{children:[(0,a.jsx)(c.$N,{children:"approve"===R.type?"Approve Exeat Request":"reject"===R.type?"Reject Exeat Request":"Send Comment to Student"}),(0,a.jsx)(c.Be,{children:R.request&&"approve"===R.type?(0,a.jsxs)(a.Fragment,{children:[(0,y.xE)(R.request.status,"".concat(R.request.student.fname," ").concat(R.request.student.lname),R.request.reason,R.request.destination,Math.ceil((new Date(R.request.return_date).getTime()-new Date(R.request.departure_date).getTime())/864e5)),(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"font-medium text-green-700",children:"This action cannot be undone."})]}):R.request&&"reject"===R.type?(0,a.jsxs)(a.Fragment,{children:[(0,y.G4)(R.request.status,"".concat(R.request.student.fname," ").concat(R.request.student.lname),R.request.reason,R.request.destination,Math.ceil((new Date(R.request.return_date).getTime()-new Date(R.request.departure_date).getTime())/864e5)),(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"font-medium text-red-700",children:"This action cannot be undone."})]}):R.request&&"see_me"===R.type?(0,a.jsxs)(a.Fragment,{children:["Send a message to ",R.request.student.fname," ",R.request.student.lname," requesting them to see you."]}):"approve"===R.type?"Are you sure you want to approve this exeat request? You can add an optional comment below.":"reject"===R.type?"Are you sure you want to reject this exeat request? Please provide a reason for rejection.":"Please provide a message for the student."})]}),(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"approve"===R.type?"Comment (Optional)":"reject"===R.type?"Reason for Rejection *":"Message for Student *"}),(0,a.jsx)(d.g,{placeholder:"approve"===R.type?"Add any additional notes or conditions...":"reject"===R.type?"Please provide a reason for rejection...":"Enter your message for the student...",value:R.comment,onChange:e=>Z(s=>({...s,comment:e.target.value})),className:"mt-1",rows:3,defaultValue:"see_me"===R.type?"Come to my office to see me":"",required:"reject"===R.type||"see_me"===R.type})]})}),(0,a.jsxs)(c.cN,{children:[(0,a.jsx)(r.z,{variant:"outline",onClick:()=>Z({isOpen:!1,type:null,requestId:null,comment:"",request:null,isLoading:!1}),disabled:R.isLoading,children:"Cancel"}),(0,a.jsx)(r.z,{onClick:S,className:"approve"===R.type?"bg-green-600 hover:bg-green-700":"reject"===R.type?"bg-red-600 hover:bg-red-700":"",disabled:R.isLoading||("reject"===R.type||"see_me"===R.type)&&!R.comment.trim(),children:R.isLoading?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):"approve"===R.type?"Approve Request":"reject"===R.type?"Reject Request":"Send Comment"})]})]})})]})}},73578:function(e,s,t){t.d(s,{RM:function(){return c},SC:function(){return d},iA:function(){return l},pj:function(){return m},ss:function(){return o},xD:function(){return i}});var a=t(57437),n=t(2265),r=t(94508);let l=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:s,className:(0,r.cn)("w-full caption-bottom text-sm",t),...n})})});l.displayName="Table";let i=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("thead",{ref:s,className:(0,r.cn)("[&_tr]:border-b",t),...n})});i.displayName="TableHeader";let c=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("tbody",{ref:s,className:(0,r.cn)("[&_tr:last-child]:border-0",t),...n})});c.displayName="TableBody",n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("tfoot",{ref:s,className:(0,r.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...n})}).displayName="TableFooter";let d=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("tr",{ref:s,className:(0,r.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...n})});d.displayName="TableRow";let o=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("th",{ref:s,className:(0,r.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...n})});o.displayName="TableHead";let m=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("td",{ref:s,className:(0,r.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...n})});m.displayName="TableCell",n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("caption",{ref:s,className:(0,r.cn)("mt-4 text-sm text-muted-foreground",t),...n})}).displayName="TableCaption"},46747:function(e,s,t){t.d(s,{Z:function(){return a}});let a=(0,t(96471).Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])}}]);