"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[141],{34324:function(e,r,t){t.d(r,{i:function(){return s}});var o=t(57437),n=t(2265),l=t(99376),a=t(68575),i=t(61796);function s(e){let{children:r,requiredRole:t}=e,s=(0,l.useRouter)(),u=(0,a.v9)(i.HF),d=(0,a.v9)(i.vN);return((0,n.useEffect)(()=>{if(!d){s.push("/login");return}if(t&&(null==u?void 0:u.role)){let e=u.role.toLowerCase(),r=t.toLowerCase(),o="student"===e?"student":"staff";o!==("student"===r?"student":"staff")&&s.push("student"===o?"/student/dashboard":"/staff/dashboard")}},[d,u,t,s]),!d||t&&(null==u?void 0:u.role)&&("student"===u.role.toLowerCase()?"student":"staff")!=("student"===t.toLowerCase()?"student":"staff"))?null:(0,o.jsx)(o.Fragment,{children:r})}},93022:function(e,r,t){t.d(r,{O:function(){return l}});var o=t(57437),n=t(94508);function l(e){let{className:r,...t}=e;return(0,o.jsx)("div",{className:(0,n.cn)("animate-pulse rounded-md bg-muted",r),...t})}},63645:function(e,r,t){t.d(r,{b0:function(){return s},iy:function(){return i}});var o=t(2265),n=t(28233),l=t(81499),a=t(42676);let i=()=>{let{data:e,isLoading:r,error:t}=(0,n.b)(),{data:i,isLoading:s}=(0,n.s$)(),u=(0,o.useMemo)(()=>r=>{try{{let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);if(t.roles&&Array.isArray(t.roles)&&t.roles.includes(r))return!0}}}catch(e){console.error("Error checking localStorage for roles:",e)}if((null==e?void 0:e.exeat_roles)&&e.exeat_roles.map(e=>(0,l.h)(e)).includes(r))return!0;try{{let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);if(t.exeat_roles&&Array.isArray(t.exeat_roles)&&t.exeat_roles.map(e=>{var r;return(null===(r=e.role)||void 0===r?void 0:r.name)||("string"==typeof e.role?e.role:"")}).filter(Boolean).includes(r))return!0}}}catch(e){console.error("Error checking localStorage exeat_roles:",e)}return!1},[e]),d=(0,o.useMemo)(()=>(null==e?void 0:e.exeat_roles)&&e.exeat_roles.length>1,[e]),c=(0,o.useMemo)(()=>{var r,t;return null==e?void 0:null===(t=e.exeat_roles)||void 0===t?void 0:null===(r=t[0])||void 0===r?void 0:r.role},[e]),m=(0,o.useMemo)(()=>{if((null==e?void 0:e.exeat_roles)&&e.exeat_roles.length>0)return e.exeat_roles.map(e=>e.role);try{let e=localStorage.getItem("user");if(e){let r=JSON.parse(e);if(r.roles&&Array.isArray(r.roles)&&r.roles.length>0)return r.roles.map(e=>({name:e,display_name:e.charAt(0).toUpperCase()+e.slice(1).replace("_"," "),description:""}))}}catch(e){console.error("Error reading roles from localStorage:",e)}return[]},[e]),f=(0,o.useMemo)(()=>u("dean")||u("secretary"),[u]),g=(0,o.useMemo)(()=>u("cmd"),[u]),p=(0,o.useMemo)(()=>u("hostel_admin"),[u]),v=(0,o.useMemo)(()=>u("dean"),[u]),[y]=(0,n.mM)(),h=async(e,r)=>{try{let t=[],o=null;{let e=localStorage.getItem("user");if(e)try{!(t=(o=JSON.parse(e)).roles||[]).length&&o.exeat_roles&&(t=o.exeat_roles.map(e=>{var r;return(null===(r=e.role)||void 0===r?void 0:r.name)||("string"==typeof e.role?e.role:"")}).filter(Boolean))}catch(e){console.error("DEBUG: Error parsing user from localStorage:",e)}}if(!t.some(e=>["admin","dean","deputy_dean"].includes(e)))throw Error("You do not have permission to edit exeat requests");let n=t[0]||"",l=(0,a.nd)(n),i=Object.fromEntries(Object.entries(r).filter(e=>{let[r]=e;return l.includes(r)}));if(0===Object.keys(i).length)throw Error("No valid fields to update");return await y({exeat_request_id:e,payload:i})}catch(e){throw console.error("DEBUG: Error in editExeatRequestWithAccess:",e),e}};return{profile:(0,o.useMemo)(()=>{if(e)return e;try{let e=localStorage.getItem("user");if(e)return JSON.parse(e)}catch(e){console.error("Error reading user from localStorage:",e)}return null},[e]),profileLoading:r,profileError:t,statistics:i,statsLoading:s,hasRole:u,hasMultipleRoles:d,primaryRole:c,allRoles:m,canApproveExeat:f,canVetMedical:g,canSignStudents:p,canOverrideApprovals:v,getRoleSpecificRequests:()=>u("cmd")?(0,n.cu)("cmd_review"):u("dean")||u("secretary")?(0,n.Sr)():u("hostel_admin")?(0,n.cu)("approved"):(0,n.Sr)(),approveExeatRequest:(0,n.Vm)(),rejectExeatRequest:(0,n.yH)(),signStudentOut:(0,n.Og)(),signStudentIn:(0,n.Tq)(),sendComment:(0,n.ui)(),editExeatRequest:(0,n.mM)(),editExeatRequestWithAccess:h}},s=e=>{let{hasRole:r}=i(),t=(0,n.Sr)(),o=(0,n.cu)(e||"");return r("cmd")?(0,n.cu)("cmd_review"):e&&"all"!==e?o:t}},16262:function(e,r,t){t.d(r,{Mx:function(){return a},YA:function(){return n},_y:function(){return l},iJ:function(){return o}});let o=t(46144).h.injectEndpoints({endpoints:e=>({login:e.mutation({query:e=>({url:"/login",method:"POST",body:e})}),logout:e.mutation({query:()=>({url:"/logout",method:"POST"})}),getProfile:e.query({query:()=>"/me",providesTags:["Profile"]})})}),{useLoginMutation:n,useLogoutMutation:l,useGetProfileQuery:a}=o},61796:function(e,r,t){t.d(r,{Dj:function(){return m},HF:function(){return f},kS:function(){return c},vN:function(){return g},xU:function(){return p}});var o=t(39129),n=t(16262);let l=e=>{try{return localStorage.getItem(e)}catch(e){return null}},a=()=>{let e=l("user");try{let r=e?JSON.parse(e):null;if(r&&r.exeat_roles&&!r.roles){let e=r.exeat_roles.map(e=>{var r;return(null==e?void 0:null===(r=e.role)||void 0===r?void 0:r.name)?e.role.name:(null==e?void 0:e.name)?e.name:(null==e?void 0:e.display_name)?e.display_name:"string"==typeof e?e:"Unknown Role"});r.roles=e}return r}catch(e){return null}},i={user:a(),token:l("token"),isAuthenticated:!!(l("token")&&a()),isLoading:!1},s=(0,o.oM)({name:"auth",initialState:i,reducers:{startLoading:e=>{e.isLoading=!0},stopLoading:e=>{e.isLoading=!1},logout:e=>{e.user=null,e.token=null,e.isAuthenticated=!1,localStorage.removeItem("token"),localStorage.removeItem("user")},setCredentials:(e,r)=>{let{user:t,role:o,token:n}=r.payload,l=(null==t?void 0:t.exeat_roles)||r.payload.roles,a=Array.isArray(l)?l.map(e=>{var r;return(null==e?void 0:null===(r=e.role)||void 0===r?void 0:r.name)?e.role.name:(null==e?void 0:e.name)?e.name:(null==e?void 0:e.display_name)?e.display_name:"string"==typeof e?e:"Unknown Role"}):[],i={...t,role:o,roles:a};e.user=i,e.token=n,e.isAuthenticated=!0,localStorage.setItem("token",n),localStorage.setItem("user",JSON.stringify(i))}},extraReducers:e=>{e.addMatcher(n.iJ.endpoints.login.matchPending,e=>{e.isLoading=!0}).addMatcher(n.iJ.endpoints.login.matchFulfilled,(e,r)=>{var t;let{payload:o}=r,n=(null===(t=o.user)||void 0===t?void 0:t.exeat_roles)||o.roles,l=Array.isArray(n)?n.map(e=>{var r;return(null==e?void 0:null===(r=e.role)||void 0===r?void 0:r.name)?e.role.name:(null==e?void 0:e.name)?e.name:(null==e?void 0:e.display_name)?e.display_name:"string"==typeof e?e:"Unknown Role"}):[],a={...o.user,role:o.role,roles:l};e.user=a,e.token=o.token,e.isAuthenticated=!0,e.isLoading=!1,localStorage.setItem("token",o.token),localStorage.setItem("user",JSON.stringify(a))}).addMatcher(n.iJ.endpoints.login.matchRejected,e=>{e.isLoading=!1})}}),{startLoading:u,stopLoading:d,logout:c,setCredentials:m}=s.actions;r.ZP=s.reducer;let f=e=>e.auth.user,g=e=>e.auth.isAuthenticated,p=e=>e.auth.isLoading},81499:function(e,r,t){t.d(r,{h:function(){return o}});let o=e=>{if(!e)return"Unknown Role";if("string"==typeof e)return e;if("object"==typeof e){if(e.role&&"object"==typeof e.role&&e.role.name)return e.role.name;if(e.name)return e.name;if(e.display_name)return e.display_name}return"Unknown Role"}},81475:function(e,r,t){t.d(r,{Z:function(){return o}});let o=(0,t(96471).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])}}]);